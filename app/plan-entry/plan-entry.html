<div class="w-full max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8 bg-slate-900 min-h-screen">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-3xl font-bold text-white">Monthly Plan Entry</h2>
    <div class="flex gap-2">
      <button 
        (click)="editingWorkDays.set(!editingWorkDays())"
        class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-md transition">
        {{ editingWorkDays() ? 'Cancel' : 'Edit Work Days' }}
      </button>
      <a routerLink="/" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-md transition">
        Back to Dashboard
      </a>
    </div>
  </div>

  @if (editingWorkDays()) {
    <div class="mb-6 bg-slate-800 p-6 rounded-lg border border-slate-700">
      <h3 class="text-xl font-semibold text-white mb-4">Work Days per Month</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-4">
        @for (month of months; track month) {
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-1">{{ monthNames[month] }}</label>
            <input 
              type="number" 
              [value]="workDays()[month]"
              (input)="updateWorkDays(month, +$any($event.target).value)"
              class="w-full bg-slate-700 border-slate-600 rounded-md text-white p-2 focus:ring-2 focus:ring-green-500">
          </div>
        }
      </div>
      <button 
        (click)="saveWorkDays()"
        class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-md transition">
        Save Work Days
      </button>
    </div>
  }
  
  <div class="mb-6">
    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
      <p class="text-slate-300 mb-2">Total items loaded: {{ items().length }}</p>
      <p class="text-slate-300 mb-4">Filtered items for {{ areaNames[selectedArea()] }}: {{ filteredItems().length }}</p>
      <div class="flex gap-2 flex-wrap">
        @for (area of areas; track area) {
          <button 
            (click)="selectArea(area)"
            [class.bg-blue-600]="selectedArea() === area"
            [class.bg-slate-700]="selectedArea() !== area"
            class="px-4 py-2 rounded text-white font-medium hover:bg-blue-500 transition">
            {{ areaNames[area] }} ({{ getAreaItemCount(area) }})
          </button>
        }
      </div>
    </div>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-white">Select Item ({{ filteredItems().length }})</h3>
        <button 
          (click)="showAddForm.set(!showAddForm())"
          class="bg-green-600 hover:bg-green-500 text-white font-bold py-1 px-3 rounded text-sm transition">
          {{ showAddForm() ? 'Cancel' : '+ Add' }}
        </button>
      </div>
      
      @if (showAddForm()) {
        <div class="mb-4 p-3 bg-slate-700 rounded">
          <input 
            type="text" 
            placeholder="Item Code"
            [value]="newItem().itemCode"
            (input)="updateNewItemCode($any($event.target).value)"
            class="w-full mb-2 bg-slate-600 border-slate-500 rounded text-white p-2">
          <input 
            type="text" 
            placeholder="Item Name"
            [value]="newItem().item1"
            (input)="updateNewItemName($any($event.target).value)"
            class="w-full mb-2 bg-slate-600 border-slate-500 rounded text-white p-2">
          <select 
            [value]="newItem().area"
            (change)="updateNewItemArea($any($event.target).value)"
            class="w-full mb-2 bg-slate-600 border-slate-500 rounded text-white p-2">
            @for (area of areas; track area) {
              <option [value]="area">{{ areaNames[area] }}</option>
            }
          </select>
          <button 
            (click)="addNewItem()"
            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded transition">
            Add Item
          </button>
        </div>
      }
      <div class="space-y-2 max-h-[600px] overflow-y-auto">
        @if (filteredItems().length === 0) {
          <p class="text-slate-400 text-center py-4">No items found for this area</p>
        }
        @for (item of filteredItems(); track item.itemCode) {
          @if (editingItem()?.itemCode === item.itemCode) {
            <div class="p-3 bg-slate-600 rounded">
              <input 
                type="text" 
                [value]="editingItem()!.item1"
                (input)="updateEditItemName($any($event.target).value)"
                class="w-full mb-2 bg-slate-500 rounded text-white p-2">
              <select 
                [value]="editingItem()!.area"
                (change)="updateEditItemArea($any($event.target).value)"
                class="w-full mb-2 bg-slate-500 rounded text-white p-2">
                @for (area of areas; track area) {
                  <option [value]="area">{{ areaNames[area] }}</option>
                }
              </select>
              <div class="flex gap-2">
                <button 
                  (click)="saveEditItem()"
                  class="flex-1 bg-green-600 hover:bg-green-500 text-white py-1 rounded text-sm">
                  Save
                </button>
                <button 
                  (click)="editingItem.set(null)"
                  class="flex-1 bg-slate-500 hover:bg-slate-400 text-white py-1 rounded text-sm">
                  Cancel
                </button>
              </div>
            </div>
          } @else {
            <div class="flex gap-2">
              <button 
                (click)="selectItem(item)"
                [class.bg-blue-600]="selectedItem()?.itemCode === item.itemCode"
                class="flex-1 text-left p-3 rounded bg-slate-700 hover:bg-slate-600 text-white transition">
                <div class="font-medium">{{ item.itemCode }}</div>
                <div class="text-sm text-slate-300">{{ item.item1 }}</div>
              </button>
              <button 
                (click)="startEditItem(item)"
                class="px-3 bg-yellow-600 hover:bg-yellow-500 text-white rounded text-sm">
                Edit
              </button>
            </div>
          }
        }
      </div>
    </div>

    <div class="lg:col-span-3 bg-slate-800 p-6 rounded-lg border border-slate-700">
      @if (selectedItem(); as item) {
        <div class="mb-6">
          <h3 class="text-2xl font-semibold text-white">{{ item.itemCode }}</h3>
          <p class="text-slate-300">{{ item.item1 }}</p>
          <p class="text-slate-400 text-sm">Area: {{ areaNames[item.area] }}</p>
        </div>

        <div class="overflow-x-auto mb-6">
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="bg-slate-700">
                <th class="text-left text-white font-semibold py-3 px-3 border border-slate-600 sticky left-0 bg-slate-700 z-10">Month</th>
                @for (month of months; track month) {
                  <th class="text-center text-white font-semibold py-3 px-3 border border-slate-600 min-w-[100px]">{{ monthNames[month] }}</th>
                }
                <th class="text-center text-white font-semibold py-3 px-3 border border-slate-600 min-w-[100px] bg-blue-900">Total</th>
              </tr>
            </thead>
            <tbody>
              <tr class="bg-slate-800">
                <td class="text-slate-300 font-medium py-2 px-3 border border-slate-600 sticky left-0 bg-slate-800 z-10">Work Days</td>
                @for (month of months; track month) {
                  <td class="text-center text-blue-400 font-semibold py-2 px-3 border border-slate-600">{{ workDays()[month] }}</td>
                }
                <td class="text-center text-blue-400 font-bold py-2 px-3 border border-slate-600 bg-blue-900">{{ getTotalWorkDays() }}</td>
              </tr>
              <tr class="bg-slate-750">
                <td class="text-white font-semibold py-2 px-3 border border-slate-600 sticky left-0 bg-slate-750 z-10">Plan ({{ getUnit(item) }})</td>
                @for (month of months; track month) {
                  <td class="py-2 px-2 border border-slate-600 bg-slate-700">
                    <div class="text-center text-white font-mono py-2">{{ formatNumber(item.plans[month] || 0) }}</div>
                    <input 
                      type="number" 
                      [value]="item.plans[month] || 0"
                      (input)="updatePlan(month, +$any($event.target).value)"
                      class="w-full bg-slate-600 border border-slate-500 rounded text-white p-1 text-center text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                  </td>
                }
                <td class="text-center text-green-400 font-bold py-2 px-3 border border-slate-600 bg-green-900 text-lg">{{ formatNumber(getTotalPlan(item)) }}</td>
              </tr>
              <tr class="bg-slate-800">
                <td class="text-slate-300 font-medium py-2 px-3 border border-slate-600 sticky left-0 bg-slate-800 z-10">Daily Avg</td>
                @for (month of months; track month) {
                  <td class="text-center text-yellow-400 py-2 px-3 border border-slate-600">{{ formatNumber(getDailyAvg(item, month)) }}</td>
                }
                <td class="text-center text-yellow-400 font-semibold py-2 px-3 border border-slate-600 bg-yellow-900">{{ formatNumber(getOverallDailyAvg(item)) }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <button 
          (click)="savePlan()"
          class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-md transition">
          Save Plan
        </button>
      } @else {
        <div class="flex items-center justify-center h-full text-slate-400">
          <p>Select an item to edit its monthly plan</p>
        </div>
      }
    </div>
  </div>
</div>