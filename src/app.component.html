<div class="w-full max-w-screen-2xl mx-auto p-4 sm:p-6 lg:p-8">
  <header class="mb-8">
    <h1 class="text-4xl font-bold text-white tracking-tight">CFCH Daily Report Dashboard</h1>
    <p class="text-slate-400 mt-2">Dữ liệu cập nhật cho ngày 10 tháng 10.</p>
  </header>

  <main class="space-y-12">
    <!-- Charts Section -->
    <section>
      <h2 class="text-2xl font-semibold text-white mb-4">Visual Dashboard</h2>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Chart 1: Daily Performance -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg">
          <h3 class="font-semibold text-white mb-2">Daily Performance (Act/Plan %)</h3>
          <div class="h-80">
            <canvas #dailyPerformanceChart></canvas>
          </div>
        </div>

        <!-- Chart 2: Total Output by Machine Group -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg">
          <h3 class="font-semibold text-white mb-2">Weekly Output by Machine Group (Act vs Plan)</h3>
          <div class="h-80">
            <canvas #totalOutputChart></canvas>
          </div>
        </div>

        <!-- Chart 3: Average Weekly Performance -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg">
          <h3 class="font-semibold text-white mb-2">Average Weekly Performance (%)</h3>
          <div class="h-80">
            <canvas #avgPerformanceChart></canvas>
          </div>
        </div>

        <!-- Chart 4: Total Output by Area -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg flex flex-col">
          <h3 class="font-semibold text-white mb-2">Production Proportion by Area</h3>
          <div class="relative h-80 mx-auto flex justify-center items-center">
            <canvas #areaProportionChart></canvas>
          </div>
        </div>

        <!-- Chart 5: Daily Performance Trend -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg lg:col-span-2">
          <h3 class="font-semibold text-white mb-2">Daily Performance Trend (Act/Plan %)</h3>
          <div class="h-80">
            <canvas #monthlyTrendChart></canvas>
          </div>
        </div>

        <!-- Chart 6: D-Value and Remake PR -->
        <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 shadow-lg lg:col-span-2">
          <h3 class="font-semibold text-white mb-2">D-Value and Remake PR</h3>
          <div class="flex items-center justify-center h-48 bg-slate-900/50 rounded-md">
            <p class="text-slate-400">Chart will be displayed when defect data is available.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Data Tables Section -->
    <section>
      <h2 class="text-2xl font-semibold text-white mb-4 mt-12">Data Tables</h2>
      <!-- Sewing Section -->
      <div class="mb-12">
        <h3 class="text-xl font-semibold text-white mb-4">Khu vực Sewing</h3>
        <div class="overflow-x-auto rounded-lg border border-slate-700 bg-slate-800 shadow-lg">
          <table class="w-full min-w-[1200px] text-sm text-left text-slate-300">
            <thead class="text-xs text-slate-300 uppercase bg-slate-700 sticky top-0 z-10">
              <tr>
                <th rowspan="2" class="px-6 py-3 border-b-2 border-slate-600">Nhóm máy</th>
                @for (date of dates; track date) {
                <th colspan="3" class="text-center py-2 border-b-2 border-x border-slate-600">{{ date }}</th>
                }
                <th colspan="3" class="text-center py-2 border-b-2 border-x border-slate-600 bg-slate-600">Weekly Total (6-10 Oct)</th>
                <th colspan="3" class="text-center py-2 border-b-2 border-l border-slate-600 bg-slate-600">Monthly Total (Oct)</th>
              </tr>
              <tr>
                @for (date of dates; track date) {
                <th class="text-center font-medium px-2 py-2 border-x border-slate-600">Plan</th>
                <th class="text-center font-medium px-2 py-2 border-x border-slate-600">Act</th>
                <th class="text-center font-medium px-2 py-2 border-r border-slate-600">%</th>
                }
                @for (total of [1, 2]; track total) {
                <th class="text-center font-medium px-2 py-2 border-x border-slate-600 bg-slate-600">Plan</th>
                <th class="text-center font-medium px-2 py-2 border-x border-slate-600 bg-slate-600">Act</th>
                <th class="text-center font-medium px-2 py-2 border-r border-slate-600 bg-slate-600">%</th>
                }
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-700">
              @for (line of sewingLines(); track line.name) {
              <tr class="hover:bg-slate-700/50">
                <td class="px-6 py-4 font-medium text-white whitespace-nowrap">{{ line.name }}</td>
                @for (day of line.data; track $index) {
                <td class="text-center px-2 py-4">{{ day.plan }}</td>
                <td class="text-center px-2 py-4">{{ day.act ?? '-' }}</td>
                <td class="text-center px-2 py-4 font-bold">
                  @let percent = getPercentage(day.act, day.plan);
                  @if (percent !== null) {
                  <span [class.text-green-400]="percent >= 100" [class.text-yellow-400]="percent < 100 && percent >= 90" [class.text-red-500]="percent < 90">
                    {{ percent }}%
                  </span>
                  } @else {
                  <span>-</span>
                  }
                </td>
                }
                @let weeklyTotal = getLineTotal(line);
                @let weeklyPercent = getPercentage(weeklyTotal.act, weeklyTotal.plan);
                <td class="text-center px-2 py-4 font-medium bg-slate-700/50">{{ weeklyTotal.plan }}</td>
                <td class="text-center px-2 py-4 font-medium bg-slate-700/50">{{ weeklyTotal.act }}</td>
                <td class="text-center px-2 py-4 font-bold bg-slate-700/50">
                  @if (weeklyPercent !== null) {
                  <span [class.text-green-400]="weeklyPercent >= 100" [class.text-yellow-400]="weeklyPercent < 100 && weeklyPercent >= 90" [class.text-red-500]="weeklyPercent < 90">
                    {{ weeklyPercent }}%
                  </span>
                  }
                </td>
                <td class="text-center px-2 py-4 font-medium bg-slate-700/50">{{ weeklyTotal.plan }}</td>
                <td class="text-center px-2 py-4 font-medium bg-slate-700/50">{{ weeklyTotal.act }}</td>
                <td class="text-center px-2 py-4 font-bold bg-slate-700/50">
                  @if (weeklyPercent !== null) {
                  <span [class.text-green-400]="weeklyPercent >= 100" [class.text-yellow-400]="weeklyPercent < 100 && weeklyPercent >= 90" [class.text-red-500]="weeklyPercent < 90">
                    {{ weeklyPercent }}%
                  </span>
                  }
                </td>
              </tr>
              }
            </tbody>
            <tfoot class="bg-slate-700 font-bold text-white">
              <tr>
                <td class="px-6 py-3">Weekly Total</td>
                @for (i of [0, 1, 2, 3, 4]; track i) {
                @let dailyTotal = getDailyTotal(i);
                @let dailyPercent = getPercentage(dailyTotal.act, dailyTotal.plan);
                <td class="text-center px-2 py-3">{{ dailyTotal.plan }}</td>
                <td class="text-center px-2 py-3">{{ dailyTotal.act }}</td>
                <td class="text-center px-2 py-3">
                  @if (dailyPercent) {
                  <span [class.text-green-400]="dailyPercent >= 100" [class.text-yellow-400]="dailyPercent < 100 && dailyPercent >= 90" [class.text-red-500]="dailyPercent < 90">
                    {{ dailyPercent }}%
                  </span>
                  } @else {
                  <span>-</span>
                  }
                </td>
                }
                @let overallTotal = getOverallTotal();
                @let overallPercent = getPercentage(overallTotal.act, overallTotal.plan);
                <td class="text-center px-2 py-3 bg-slate-600">{{ overallTotal.plan }}</td>
                <td class="text-center px-2 py-3 bg-slate-600">{{ overallTotal.act }}</td>
                <td class="text-center px-2 py-3 bg-slate-600">
                  @if(overallPercent) {
                  <span [class.text-green-400]="overallPercent >= 100" [class.text-yellow-400]="overallPercent < 100 && overallPercent >= 90" [class.text-red-500]="overallPercent < 90">
                    {{ overallPercent }}%
                  </span>
                  }
                </td>
                <td class="text-center px-2 py-3 bg-slate-600">{{ overallTotal.plan }}</td>
                <td class="text-center px-2 py-3 bg-slate-600">{{ overallTotal.act }}</td>
                <td class="text-center px-2 py-3 bg-slate-600">
                  @if(overallPercent) {
                  <span [class.text-green-400]="overallPercent >= 100" [class.text-yellow-400]="overallPercent < 100 && overallPercent >= 90" [class.text-red-500]="overallPercent < 90">
                    {{ overallPercent }}%
                  </span>
                  }
                </td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- Forming Section -->
      <div>
        <h3 class="text-xl font-semibold text-white mb-4">Khu vực Forming</h3>
        <div class="overflow-x-auto rounded-lg border border-slate-700 bg-slate-800 shadow-lg">
          <table class="w-full min-w-[800px] text-sm text-left text-slate-300">
            <thead class="text-xs text-slate-300 uppercase bg-slate-700">
              <tr>
                <th class="px-6 py-3">Element</th>
                <th class="px-6 py-3">Mã hàng</th>
                @for (date of dates; track date) {
                <th class="px-6 py-3 text-right">{{ date }} (Kg)</th>
                }
                <th class="px-6 py-3 text-right">Tổng khối lượng (Kg)</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-700">
              @for (item of formingData(); track item.element) {
              <tr class="hover:bg-slate-700/50">
                <td class="px-6 py-4 font-medium text-white">{{ item.element }}</td>
                <td class="px-6 py-4">{{ item.itemCode }}</td>
                @for (prod of item.dailyProd; track $index) {
                <td class="px-6 py-4 text-right">{{ prod?.toLocaleString() ?? '-' }}</td>
                }
                <td class="px-6 py-4 text-right font-bold text-white">{{ getFormingTotal(item).toLocaleString() }}</td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </section>
  </main>
</div>